import React, { useState, useCallback, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import {
    Card,
    CardContent,
    CardDescription,
    CardHeader,
    CardTitle,
} from '@/components/ui/card';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { useForm, FormProvider } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';
import { motion, AnimatePresence } from 'framer-motion';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { AlertCircle } from 'lucide-react';
import { CardFooter } from "@/components/ui/card"

// Definir el esquema de validación con Zod
const registroSchema = z.object({
    nombre: z.string().min(2, { message: 'El nombre debe tener al menos 2 caracteres.' }).max(50),
    apellidoPaterno: z.string().min(2, { message: 'El apellido paterno debe tener al menos 2 caracteres.' }).max(50),
    apellidoMaterno: z.string().min(2, { message: 'El apellido materno debe tener al menos 2 caracteres.' }).max(50),
    correoElectronico: z.string().email({ message: 'Correo electrónico no válido.' }),
    numeroTelefono: z.string().min(7, { message: 'Número de teléfono no válido.' }).max(15),
    iglesia: z.string().min(1, { message: 'Debe seleccionar una iglesia.' }),
    edad: z.number().min(1, { message: 'La edad debe ser mayor a 0.' }).max(150, { message: 'La edad debe ser menor a 150' }).optional(),
    talla: z.enum(['Ch', 'M', 'G', 'EG', 'EEG'], {
        required_error: "Debe seleccionar una talla.",
    }).optional(),
});

// Definir las opciones para los selects
const iglesias = [
    { value: 'iglesia-1', label: 'Iglesia El Buen Pastor' },
    { value: 'iglesia-2', label: 'Iglesia La Roca Eterna' },
    { value: 'iglesia-3', label: 'Iglesia Fuente de Vida' },
    { value: 'iglesia-4', label: 'Iglesia Nueva Esperanza' },
    { value: 'otra', label: 'Otra' },
];

const opcionesTalla = [
    { value: 'Ch', label: 'Ch' },
    { value: 'M', label: 'M' },
    { value: 'G', label: 'G' },
    { value: 'EG', label: 'EG' },
    { value: 'EEG', label: 'EEG' },
];

const RegistroForm = () => {
    // Estados para manejar el éxito o error del registro
    const [registroExitoso, setRegistroExitoso] = useState(false);
    const [errorRegistro, setErrorRegistro] = useState<string | null>(null);
    const imageUrl = "https://i.imgur.com/your-imgur-image.png"; // Reemplaza con la URL de tu imagen

    // Inicializar el formulario con react-hook-form
    const formMethods = useForm<z.infer<typeof registroSchema>>({
        resolver: zodResolver(registroSchema),
        defaultValues: {
            nombre: '',
            apellidoPaterno: '',
            apellidoMaterno: '',
            correoElectronico: '',
            numeroTelefono: '',
            iglesia: '',
            edad: undefined,
            talla: undefined,
        },
    });

    // Obtener funciones y estado del formulario
    const {
        handleSubmit,
        formState: { isSubmitting },
        control,
        reset,
        formState: { errors }
    } = formMethods;

    // Función para manejar el envío del formulario
    const onSubmit = useCallback(async (data: z.infer<typeof registroSchema>) => {
        console.log('Datos del formulario:', data);

        // Simular una respuesta de la API (reemplazar con tu lógica real)
        try {
            // Simular un retraso de 2 segundos
            await new Promise(resolve => setTimeout(resolve, 2000));

            // Simular un registro exitoso
            setRegistroExitoso(true);
            setErrorRegistro(null);
            reset();

            // Simular un error (para probar la UI de error)
            //  throw new Error('Ocurrió un error al registrar el usuario. Por favor, intente nuevamente.');

        } catch (error: any) {
            setErrorRegistro(error.message || 'Ocurrió un error al registrar el usuario. Por favor, intente nuevamente.');
            setRegistroExitoso(false);
        }
    }, [reset]);

    // Renderizar el formulario
    return (
        <div className="flex justify-center items-center py-10 bg-black">
            <Card className="w-full max-w-2xl bg-transparent border-none shadow-lg">
                <CardHeader className="flex flex-col items-center">
                    <img
                        src={imageUrl}
                        alt="Logo del Congreso"
                        className="max-w-xs mb-4 rounded-full"
                        style={{
                            display: 'block',
                            margin: '0 auto',
                            maxWidth: '100%',
                            height: 'auto',
                            borderRadius: '50%',
                        }}
                    />
                    <CardTitle className="text-2xl font-semibold text-white text-center">Registro al Congreso</CardTitle>
                </CardHeader>
                <CardContent>
                    <Form {...formMethods} onSubmit={handleSubmit(onSubmit)} className="space-y-6">
                        {errorRegistro && (
                            <Alert variant="destructive">
                                <AlertCircle className="h-4 w-4" />
                                <AlertTitle>Error</AlertTitle>
                                <AlertDescription>{errorRegistro}</AlertDescription>
                            </Alert>
                        )}
                        <div className="grid grid-cols-2 gap-6">
                            <FormField
                                control={control}
                                name="nombre"
                                render={({ field }) => (
                                    <FormItem>
                                        <FormLabel className="text-white">Nombre</FormLabel>
                                        <FormControl>
                                            <Input
                                                placeholder="Ingrese su nombre"
                                                {...field}
                                                className="bg-black/20 text-white border-gray-700 placeholder:text-gray-400"
                                            />
                                        </FormControl>
                                        <FormMessage className="text-red-400" />
                                    </FormItem>
                                )}
                            />
                            <FormField
                                control={control}
                                name="apellidoPaterno"
                                render={({ field }) => (
                                    <FormItem>
                                        <FormLabel className="text-white">Apellido Paterno</FormLabel>
                                        <FormControl>
                                            <Input
                                                placeholder="Ingrese su apellido paterno"
                                                {...field}
                                                className="bg-black/20 text-white border-gray-700 placeholder:text-gray-400"
                                            />
                                        </FormControl>
                                        <FormMessage className="text-red-400" />
                                    </FormItem>
                                )}
                            />
                        </div>
                        <FormField
                            control={control}
                            name="apellidoMaterno"
                            render={({ field }) => (
                                <FormItem>
                                    <FormLabel className="text-white">Apellido Materno</FormLabel>
                                    <FormControl>
                                        <Input
                                            placeholder="Ingrese su apellido materno"
                                            {...field}
                                            className="bg-black/20 text-white border-gray-700 placeholder:text-gray-400"
                                        />
                                    </FormControl>
                                    <FormMessage className="text-red-400" />
                                </FormItem>
                            )}
                        />
                        <FormField
                            control={control}
                            name="correoElectronico"
                            render={({ field }) => (
                                <FormItem>
                                    <FormLabel className="text-white">Correo Electrónico</FormLabel>
                                    <FormControl>
                                        <Input
                                            placeholder="Ingrese su correo electrónico"
                                            {...field}
                                            type="email"
                                            className="bg-black/20 text-white border-gray-700 placeholder:text-gray-400"
                                        />
                                    </FormControl>
                                    <FormMessage className="text-red-400" />
                                </FormItem>
                            )}
                        />
                        <FormField
                            control={control}
                            name="numeroTelefono"
                            render={({ field }) => (
                                <FormItem>
                                    <FormLabel className="text-white">Número de Teléfono</FormLabel>
                                    <FormControl>
                                        <Input
                                            placeholder="Ingrese su número de teléfono"
                                            {...field}
                                            type="tel"
                                            className="bg-black/20 text-white border-gray-700 placeholder:text-gray-400"
                                        />
                                    </FormControl>
                                    <FormMessage className="text-red-400" />
                                </FormItem>
                            )}
                        />
                        <div className="grid grid-cols-2 gap-6">
                            <FormField
                                control={control}
                                name="edad"
                                render={({ field }) => (
                                    <FormItem>
                                        <FormLabel className="text-white">Edad</FormLabel>
                                        <FormControl>
                                            <Input
                                                placeholder="Ingrese su edad"
                                                {...field}
                                                type="number"
                                                className="bg-black/20 text-white border-gray-700 placeholder:text-gray-400"
                                            />
                                        </FormControl>
                                        <FormMessage className="text-red-400" />
                                    </FormItem>
                                )}
                            />
                            <FormField
                                control={control}
                                name="talla"
                                render={({ field }) => (
                                    <FormItem>
                                        <FormLabel className="text-white">Talla (Playera)</FormLabel>
                                        <FormControl>
                                            <Select onValueChange={field.onChange} value={field.value} >
                                                <SelectTrigger className="bg-black/20 text-white border-gray-700">
                                                    <SelectValue placeholder="Selecciona tu talla de playera" className="text-gray-400" />
                                                </SelectTrigger>
                                                <SelectContent className="bg-gray-800 border-gray-700">
                                                    {opcionesTalla.map((talla) => (
                                                        <SelectItem
                                                            key={talla.value}
                                                            value={talla.value}
                                                            className="hover:bg-gray-700/50 text-white"
                                                        >
                                                            {talla.label}
                                                        </SelectItem>
                                                    ))}
                                                </SelectContent>
                                            </Select>
                                        </FormControl>
                                        <FormMessage className="text-red-400" />
                                    </FormItem>
                                )}
                            />
                        </div>
                        <FormField
                            control={control}
                            name="iglesia"
                            render={({ field }) => (
                                <FormItem>
                                    <FormLabel className="text-white">Iglesia</FormLabel>
                                    <FormControl>
                                        <Select onValueChange={field.onChange} value={field.value}>
                                            <SelectTrigger className="bg-black/20 text-white border-gray-700">
                                                <SelectValue placeholder="Seleccione su iglesia" className="text-gray-400" />
                                            </SelectTrigger>
                                            <SelectContent className="bg-gray-800 border-gray-700">
                                                {iglesias.map((iglesia) => (
                                                    <SelectItem
                                                        key={iglesia.value}
                                                        value={iglesia.value}
                                                        className="hover:bg-gray-700/50 text-white"
                                                    >
                                                        {iglesia.label}
                                                    </SelectItem>
                                                ))}
                                                <SelectItem
                                                    key="otra"
                                                    value="otra"
                                                    className="hover:bg-gray-700/50 text-white"
                                                >
                                                    Otra
                                                </SelectItem>
                                            </SelectContent>
                                        </Select>
                                    </FormControl>
                                    <FormMessage className="text-red-400" />
                                </FormItem>
                            )}
                        />

                        <CardFooter className="flex justify-center">
                            <Button
                                type="submit"
                                className="px-8 py-3 bg-black text-white hover:bg-gray-800
                                        transition-colors duration-300 text-lg font-semibold"
                                disabled={isSubmitting}
                                style={{ width: 'fit-content' }}
                            >
                                {isSubmitting ? 'Registrando...' : 'Registrarse'}
                            </Button>
                        </CardFooter>
                    </Form>
                </CardContent>
                <AnimatePresence>
                    {registroExitoso && (
                        <motion.div
                            initial={{ opacity: 0, y: 20 }}
                            animate={{ opacity: 1, y: 0 }}
                            exit={{ opacity: 0, y: -20 }}
                            className="absolute inset-0 bg-black/50 flex items-center justify-center"
                        >
                            <Card className="w-full max-w-md bg-white/90 backdrop-blur-md border border-white/10 shadow-lg p-6 text-center">
                                <CardTitle className="text-2xl font-semibold text-green-600">
                                    ¡Registro Exitoso!
                                </CardTitle>
                                <CardDescription className="text-gray-700 mb-4">
                                    Su registro se ha completado correctamente.
                                </CardDescription>
                                <p className="text-gray-700">
                                    En breve recibirá un correo electrónico con los detalles de su registro.
                                </p>
                                <Button
                                    onClick={() => setRegistroExitoso(false)}
                                    className="mt-6 w-full bg-blue-500/90 text-white hover:bg-blue-500
                                            transition-colors duration-300 py-3 text-lg font-semibold"
                                >
                                    Cerrar
                                </Button>
                            </Card>
                        </motion.div>
                    )}
                </AnimatePresence>
            </Card>
        </div>
    );
};

export default RegistroForm;
